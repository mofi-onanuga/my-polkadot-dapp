import { atom } from 'jotai/vanilla';
import { soon } from './soon.js';
import { soonAll } from './soonAll.js';
/**
 * Awaits all `deps` if necessary, then runs `op` given all deps in the same order.
 * If computing the value fails (throws), a rejected Promise is returned no matter if
 * the processing happened synchronously or not.
 */
export function derive(deps, op) {
    return atom((get) => {
        try {
            return soon(soonAll(deps.map(get)), (values) => op(...values));
        }
        catch (err) {
            return Promise.reject(err);
        }
    });
}
