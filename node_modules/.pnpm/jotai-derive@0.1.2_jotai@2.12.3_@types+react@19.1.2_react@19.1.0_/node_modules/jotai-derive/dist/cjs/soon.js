"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.soon = soon;
const isPromise_js_1 = require("./isPromise.js");
function soon(first, second) {
    if (second) {
        // data-first
        return _soonImpl(first, second);
    }
    // data-last
    return (data) => {
        return _soonImpl(data, first);
    };
}
function _soonImpl(data, process) {
    if ((0, isPromise_js_1.isPromise)(data)) {
        if (data.status === 'fulfilled') {
            // can process the value earlier
            return process(data.value);
        }
        if (data.status === 'rejected') {
            // To keep the error handling behavior consistent, lets
            // always return a rejected promise, even if the processing
            // can be done in sync.
            return Promise.reject(data.reason);
        }
        return data.then((value) => process(value));
    }
    try {
        return process(data);
    }
    catch (err) {
        // To keep the error handling behavior consistent, lets
        // always return a rejected promise, even if the processing
        // can be done in sync.
        return Promise.reject(err);
    }
}
