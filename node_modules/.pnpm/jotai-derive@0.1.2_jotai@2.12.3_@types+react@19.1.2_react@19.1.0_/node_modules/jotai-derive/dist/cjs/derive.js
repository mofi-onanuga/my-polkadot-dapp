"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.derive = derive;
const vanilla_1 = require("jotai/vanilla");
const soon_js_1 = require("./soon.js");
const soonAll_js_1 = require("./soonAll.js");
/**
 * Awaits all `deps` if necessary, then runs `op` given all deps in the same order.
 * If computing the value fails (throws), a rejected Promise is returned no matter if
 * the processing happened synchronously or not.
 */
function derive(deps, op) {
    return (0, vanilla_1.atom)((get) => {
        try {
            return (0, soon_js_1.soon)((0, soonAll_js_1.soonAll)(deps.map(get)), (values) => op(...values));
        }
        catch (err) {
            return Promise.reject(err);
        }
    });
}
